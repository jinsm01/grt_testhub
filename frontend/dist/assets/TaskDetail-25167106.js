import{_ as x,C as f,e as u,r as w,o as h,c as g,b as s,t as d,G as k,B as v,d as S,w as T,f as m,ab as D,F as I,y as P,N as y,P as E,A as L,aa as A}from"./index-0220ec78.js";import{u as b,w as M}from"./xlsx-f5126985.js";const z={name:"TaskDetail",data(){return{taskId:"",task:{},testCases:[],selectedCases:[],isLoading:!0,showCaseDetail:!1,selectedCase:{},selectedCaseIndex:0,currentPage:1,pageSize:10,isExporting:!1}},computed:{isAllSelected(){return this.testCases.length>0&&this.selectedCases.length===this.testCases.length},totalPages(){return Math.ceil(this.testCases.length/this.pageSize)},paginatedTestCases(){const a=(this.currentPage-1)*this.pageSize,e=a+this.pageSize;return this.testCases.slice(a,e)},paginationStart(){return(this.currentPage-1)*this.pageSize+1},paginationEnd(){return Math.min(this.currentPage*this.pageSize,this.testCases.length)}},mounted(){this.taskId=this.$route.params.taskId,this.loadTaskDetail()},methods:{async loadTaskDetail(){try{const a=await f.get(`/requirement-analysis/api/testcase-generation/${this.taskId}/`);this.task=a.data,this.task.final_test_cases&&(this.testCases=this.parseTestCases(this.task.final_test_cases))}catch(a){console.error("åŠ è½½ä»»åŠ¡è¯¦æƒ…å¤±è´¥:",a),u.error("åŠ è½½ä»»åŠ¡è¯¦æƒ…å¤±è´¥")}finally{this.isLoading=!1}},parseTestCases(a){if(!a)return[];const e=a.split(`
`).filter(l=>l.trim()),n=[];let c=!1;const t=[];for(let l of e){const r=l.trim();if(r.includes("|")&&!r.includes("--------")){const o=r.split("|").map(i=>i.trim()).filter(i=>i);o.length>1&&(t.push(o),c=!0)}}if(c&&t.length>1){const l=t[0];for(let r=1;r<t.length;r++){const o=t[r],i={};l.forEach((p,C)=>{const _=o[C]||"";p.includes("ç¼–å·")||p.includes("ID")||p.includes("ç”¨ä¾‹ID")?i.caseId=_:p.includes("åœºæ™¯")||p.includes("æ ‡é¢˜")||p.includes("æµ‹è¯•ç›®æ ‡")?i.scenario=_:p.includes("å‰ç½®")?i.precondition=_:p.includes("æ­¥éª¤")||p.includes("æ“ä½œæ­¥éª¤")?i.steps=_:p.includes("é¢„æœŸ")||p.includes("ç»“æœ")?i.expected=_:p.includes("ä¼˜å…ˆçº§")&&(i.priority=_)}),(i.scenario||i.caseId)&&(!i.steps&&i.scenario&&(i.steps="å‚è€ƒæµ‹è¯•ç›®æ ‡æ‰§è¡Œç›¸åº”æ“ä½œ"),n.push(i))}}else{let l={},r=1;for(const o of e)o.includes("æµ‹è¯•ç”¨ä¾‹")||o.includes("Test Case")||o.match(/^(\d+\.|\*|\-|\d+ã€)/)?(Object.keys(l).length>0&&(n.push(l),r++),l={caseId:`TC${String(r).padStart(3,"0")}`,scenario:o.replace(/^(\d+\.|\*|\-|\d+ã€)\s*/,"").replace(/æµ‹è¯•ç”¨ä¾‹\d*[:ï¼š]?\s*/,""),precondition:"",steps:"",expected:"",priority:"ä¸­"}):o.includes("å‰ç½®æ¡ä»¶")||o.includes("å‰æ")?l.precondition=o.replace(/.*?[:ï¼š]\s*/,""):o.includes("æµ‹è¯•æ­¥éª¤")||o.includes("æ“ä½œæ­¥éª¤")||o.includes("æ­¥éª¤")?l.steps=o.replace(/.*?[:ï¼š]\s*/,""):o.includes("é¢„æœŸç»“æœ")||o.includes("Expected")?l.expected=o.replace(/.*?[:ï¼š]\s*/,""):o.includes("ä¼˜å…ˆçº§")&&(l.priority=o.replace(/.*?[:ï¼š]\s*/,""));Object.keys(l).length>0&&n.push(l)}return n},getStatusText(a){return{pending:"éœ€æ±‚åˆ†æä¸­",generating:"ç”¨ä¾‹ç¼–å†™ä¸­",reviewing:"ç”¨ä¾‹è¯„å®¡ä¸­",completed:"å·²å®Œæˆ",failed:"å¤±è´¥"}[a]||a},formatTextForList(a){return a?a.replace(/<br\s*\/?>/gi,`
`):""},toggleSelectAll(){this.isAllSelected?this.selectedCases=[]:this.selectedCases=[...this.testCases]},updateSelectAll(){},async batchAdopt(){var a,e;if(this.selectedCases.length===0){u.warning("è¯·å…ˆé€‰æ‹©è¦é‡‡çº³çš„æµ‹è¯•ç”¨ä¾‹");return}if(confirm(`ç¡®å®šè¦é‡‡çº³é€‰ä¸­çš„ ${this.selectedCases.length} æ¡æµ‹è¯•ç”¨ä¾‹å—ï¼Ÿ`))try{const n=this.selectedCases.map((c,t)=>({title:c.scenario||`æµ‹è¯•ç”¨ä¾‹${t+1}`,description:c.scenario||"",preconditions:c.precondition||"",steps:c.steps||"",expected_result:c.expected||"",priority:this.mapPriority(c.priority),test_type:"functional",status:"draft"}));await f.post(`/requirement-analysis/api/testcase-generation/${this.taskId}/batch_adopt_selected/`,{test_cases:n}),u.success(`æˆåŠŸé‡‡çº³ ${this.selectedCases.length} æ¡æµ‹è¯•ç”¨ä¾‹ï¼`),this.selectedCases=[]}catch(n){console.error("æ‰¹é‡é‡‡çº³å¤±è´¥:",n),u.error("æ‰¹é‡é‡‡çº³å¤±è´¥: "+(((e=(a=n.response)==null?void 0:a.data)==null?void 0:e.message)||n.message))}},async batchDiscard(){var a,e;if(this.selectedCases.length===0){u.warning("è¯·å…ˆé€‰æ‹©è¦å¼ƒç”¨çš„æµ‹è¯•ç”¨ä¾‹");return}if(confirm(`ç¡®å®šè¦å¼ƒç”¨é€‰ä¸­çš„ ${this.selectedCases.length} æ¡æµ‹è¯•ç”¨ä¾‹å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ã€‚`))try{const n=this.selectedCases.map(t=>this.testCases.findIndex(r=>r.scenario===t.scenario&&r.steps===t.steps&&r.expected===t.expected)).filter(t=>t!==-1),c=await f.post(`/requirement-analysis/api/testcase-generation/${this.taskId}/discard_selected_cases/`,{case_indices:n});c.data.task_deleted?(u.success("æ‰€æœ‰æµ‹è¯•ç”¨ä¾‹å·²å¼ƒç”¨ï¼Œä»»åŠ¡å·²åˆ é™¤"),this.$router.push("/generated-testcases")):(u.success(`æˆåŠŸå¼ƒç”¨ ${c.data.discarded_count} æ¡æµ‹è¯•ç”¨ä¾‹`),c.data.updated_test_cases&&(this.testCases=this.parseTestCases(c.data.updated_test_cases),this.selectedCases=[],this.currentPage=1))}catch(n){console.error("æ‰¹é‡å¼ƒç”¨å¤±è´¥:",n),u.error("æ‰¹é‡å¼ƒç”¨å¤±è´¥: "+(((e=(a=n.response)==null?void 0:a.data)==null?void 0:e.error)||n.message))}},viewCaseDetail(a,e){this.selectedCase=a,this.selectedCaseIndex=e,this.showCaseDetail=!0},closeCaseDetail(){this.showCaseDetail=!1,this.selectedCase={}},async adoptSingleCase(a,e){var n,c;if(confirm(`ç¡®å®šè¦é‡‡çº³æµ‹è¯•ç”¨ä¾‹"${a.scenario}"å—ï¼Ÿ`))try{const t={title:a.scenario||`æµ‹è¯•ç”¨ä¾‹${e+1}`,description:a.scenario||"",preconditions:a.precondition||"",steps:a.steps||"",expected_result:a.expected||"",priority:this.mapPriority(a.priority),test_type:"functional",status:"draft"};await f.post("/testcases/",t),u.success("æµ‹è¯•ç”¨ä¾‹é‡‡çº³æˆåŠŸï¼")}catch(t){console.error("é‡‡çº³ç”¨ä¾‹å¤±è´¥:",t),u.error("é‡‡çº³ç”¨ä¾‹å¤±è´¥: "+(((c=(n=t.response)==null?void 0:n.data)==null?void 0:c.message)||t.message))}},discardSingleCase(a,e){if(confirm(`ç¡®å®šè¦å¼ƒç”¨æµ‹è¯•ç”¨ä¾‹"${a.scenario}"å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ã€‚`))try{const n=(this.currentPage-1)*this.pageSize+e;f.post(`/requirement-analysis/api/testcase-generation/${this.taskId}/discard_single_case/`,{case_index:n}).then(c=>{c.data.task_deleted?(u.success("æ‰€æœ‰æµ‹è¯•ç”¨ä¾‹å·²å¼ƒç”¨ï¼Œä»»åŠ¡å·²åˆ é™¤"),this.$router.push("/generated-testcases")):(u.success("æµ‹è¯•ç”¨ä¾‹å·²å¼ƒç”¨"),c.data.updated_test_cases&&(this.testCases=this.parseTestCases(c.data.updated_test_cases),this.currentPage>1&&this.paginatedTestCases.length===0&&this.currentPage--))}).catch(c=>{var t,l;console.error("å¼ƒç”¨ç”¨ä¾‹å¤±è´¥:",c),u.error("å¼ƒç”¨ç”¨ä¾‹å¤±è´¥: "+(((l=(t=c.response)==null?void 0:t.data)==null?void 0:l.error)||c.message))})}catch(n){console.error("å¼ƒç”¨ç”¨ä¾‹å¤±è´¥:",n),u.error("å¼ƒç”¨ç”¨ä¾‹å¤±è´¥")}},mapPriority(a){return{æœ€é«˜:"critical",é«˜:"high",ä¸­:"medium",ä½:"low",P0:"critical",P1:"high",P2:"medium",P3:"low"}[a]||"medium"},exportToExcel(){if(this.testCases.length===0){u.warning("æ²¡æœ‰æµ‹è¯•ç”¨ä¾‹å¯ä»¥å¯¼å‡º");return}this.isExporting=!0;try{const a=b.book_new(),e=[];e.push(["æµ‹è¯•ç”¨ä¾‹ç¼–å·","æµ‹è¯•åœºæ™¯","å‰ç½®æ¡ä»¶","æ“ä½œæ­¥éª¤","é¢„æœŸç»“æœ","ä¼˜å…ˆçº§"]),this.testCases.forEach((r,o)=>{e.push([r.caseId||`TC${String(o+1).padStart(3,"0")}`,r.scenario||"",r.precondition||"",this.formatTextForList(r.steps||""),this.formatTextForList(r.expected||""),r.priority||"ä¸­"])});const n=b.aoa_to_sheet(e),c=[{wch:15},{wch:30},{wch:25},{wch:50},{wch:40},{wch:10}];n["!cols"]=c;const t=b.decode_range(n["!ref"]);for(let r=t.s.r;r<=t.e.r;r++)for(let o=t.s.c;o<=t.e.c;o++){const i=b.encode_cell({r,c:o});n[i]&&(n[i].s={alignment:{wrapText:!0,vertical:"top"}})}b.book_append_sheet(a,n,"æµ‹è¯•ç”¨ä¾‹");const l=`æµ‹è¯•ç”¨ä¾‹_${this.taskId}_${new Date().toISOString().slice(0,10)}.xlsx`;M(a,l),u.success("æµ‹è¯•ç”¨ä¾‹å¯¼å‡ºæˆåŠŸ")}catch(a){console.error("å¯¼å‡ºExcelå¤±è´¥:",a),u.error("å¯¼å‡ºExcelå¤±è´¥: "+(a.message||"æœªçŸ¥é”™è¯¯"))}finally{this.isExporting=!1}}}},F={class:"task-detail"},N={class:"page-header"},V={class:"header-left"},q={class:"task-info"},B={class:"task-id"},H={class:"header-actions"},O=["disabled"],j={key:0},U={key:1},G={key:0,class:"loading-state"},R={key:1,class:"error-state"},W={key:2,class:"task-content"},J={key:0,class:"batch-actions"},K={class:"selection-info"},Q={class:"select-all"},X=["checked"],Y={key:0,class:"selected-count"},Z={class:"batch-buttons"},$=["disabled"],ee=["disabled"],se={key:1,class:"testcases-table"},te={class:"table-body"},ie={class:"body-cell checkbox-cell"},le=["value"],ae={class:"body-cell"},ne={class:"body-cell"},oe={class:"body-cell"},ce={class:"body-cell text-limit-2"},re={class:"body-cell text-limit-2"},de={class:"body-cell"},pe={class:"body-cell"},ue={class:"action-buttons"},he=["onClick"],ge=["onClick"],_e=["onClick"],fe={key:2,class:"empty-state"},ve={key:3,class:"pagination-section"},be={class:"pagination-info"},Ce={class:"pagination-controls"},ke={class:"page-size-selector"},me={class:"pagination-buttons"},ye=["disabled"],xe={class:"current-page"},we=["disabled"],Se={class:"modal-header"},Te={class:"modal-body"},De={class:"detail-item"},Ie={class:"detail-item"},Pe={class:"detail-item"},Ee={class:"detail-item"},Le=["innerHTML"],Ae={class:"detail-item"},Me=["innerHTML"],ze={class:"detail-item"};function Fe(a,e,n,c,t,l){var o;const r=w("router-link");return h(),g("div",F,[s("div",N,[s("div",V,[s("h2",null,"ä»»åŠ¡è¯¦æƒ… - "+d(t.task.title),1),s("div",q,[s("span",B,"ä»»åŠ¡ID: "+d(t.taskId),1),s("span",{class:k(["task-status",t.task.status])},d(l.getStatusText(t.task.status)),3)])]),s("div",H,[t.testCases.length>0?(h(),g("button",{key:0,class:"export-btn",onClick:e[0]||(e[0]=(...i)=>l.exportToExcel&&l.exportToExcel(...i)),disabled:t.isExporting},[t.isExporting?(h(),g("span",j,"ğŸ’¾ å¯¼å‡ºä¸­...")):(h(),g("span",U,"ğŸ’¾ å¯¼å‡ºExcel"))],8,O)):v("",!0)])]),t.isLoading?(h(),g("div",G,e[13]||(e[13]=[s("p",null,"ğŸ”„ æ­£åœ¨åŠ è½½ä»»åŠ¡è¯¦æƒ…...",-1)]))):t.task.task_id?(h(),g("div",W,[t.testCases.length>0?(h(),g("div",J,[s("div",K,[s("label",Q,[s("input",{type:"checkbox",checked:l.isAllSelected,onChange:e[1]||(e[1]=(...i)=>l.toggleSelectAll&&l.toggleSelectAll(...i))},null,40,X),e[16]||(e[16]=m(" å…¨é€‰ ",-1))]),t.selectedCases.length>0?(h(),g("span",Y," å·²é€‰æ‹© "+d(t.selectedCases.length)+" æ¡ç”¨ä¾‹ ",1)):v("",!0)]),s("div",Z,[s("button",{class:"batch-adopt-btn",disabled:t.selectedCases.length===0,onClick:e[2]||(e[2]=(...i)=>l.batchAdopt&&l.batchAdopt(...i))}," âœ… ä¸€é”®é‡‡çº³ ("+d(t.selectedCases.length)+") ",9,$),s("button",{class:"batch-discard-btn",disabled:t.selectedCases.length===0,onClick:e[3]||(e[3]=(...i)=>l.batchDiscard&&l.batchDiscard(...i))}," âŒ ä¸€é”®å¼ƒç”¨ ("+d(t.selectedCases.length)+") ",9,ee)])])):v("",!0),t.testCases.length>0?(h(),g("div",se,[e[17]||(e[17]=D('<div class="table-header" data-v-065992cf><div class="header-cell checkbox-cell" data-v-065992cf>é€‰æ‹©</div><div class="header-cell" data-v-065992cf>æµ‹è¯•ç”¨ä¾‹ç¼–å·</div><div class="header-cell" data-v-065992cf>æµ‹è¯•åœºæ™¯</div><div class="header-cell" data-v-065992cf>å‰ç½®æ¡ä»¶</div><div class="header-cell" data-v-065992cf>æ“ä½œæ­¥éª¤</div><div class="header-cell" data-v-065992cf>é¢„æœŸç»“æœ</div><div class="header-cell" data-v-065992cf>ä¼˜å…ˆçº§</div><div class="header-cell" data-v-065992cf>æ“ä½œ</div></div>',1)),s("div",te,[(h(!0),g(I,null,P(l.paginatedTestCases,(i,p)=>{var C;return h(),g("div",{key:i.id||p,class:"table-row"},[s("div",ie,[y(s("input",{type:"checkbox",value:i,"onUpdate:modelValue":e[4]||(e[4]=_=>t.selectedCases=_),onChange:e[5]||(e[5]=(..._)=>l.updateSelectAll&&l.updateSelectAll(..._))},null,40,le),[[A,t.selectedCases]])]),s("div",ae,d(i.caseId||`TC${String(p+1).padStart(3,"0")}`),1),s("div",ne,d(i.scenario),1),s("div",oe,d(i.precondition),1),s("div",ce,d(l.formatTextForList(i.steps)),1),s("div",re,d(l.formatTextForList(i.expected)),1),s("div",de,[s("span",{class:k(["priority-tag",(C=i.priority)==null?void 0:C.toLowerCase()])},d(i.priority||"ä¸­"),3)]),s("div",pe,[s("div",ue,[s("button",{class:"view-btn",onClick:_=>l.viewCaseDetail(i,p)},"ğŸ“– æŸ¥çœ‹è¯¦æƒ…",8,he),s("button",{class:"adopt-btn",onClick:_=>l.adoptSingleCase(i,p)},"âœ… é‡‡çº³",8,ge),s("button",{class:"discard-btn",onClick:_=>l.discardSingleCase(i,p)},"âŒ å¼ƒç”¨",8,_e)])])])}),128))])])):(h(),g("div",fe,e[18]||(e[18]=[s("h3",null,"æš‚æ— æµ‹è¯•ç”¨ä¾‹æ•°æ®",-1),s("p",null,"è¯¥ä»»åŠ¡è¿˜æ²¡æœ‰ç”Ÿæˆæµ‹è¯•ç”¨ä¾‹æˆ–ç”¨ä¾‹å·²è¢«æ¸…ç©º",-1)]))),t.testCases.length>0?(h(),g("div",ve,[s("div",be," æ˜¾ç¤º "+d(l.paginationStart)+"-"+d(l.paginationEnd)+" æ¡ï¼Œå…± "+d(t.testCases.length)+" æ¡ ",1),s("div",Ce,[s("div",ke,[e[20]||(e[20]=s("label",null,"æ¯é¡µæ˜¾ç¤ºï¼š",-1)),y(s("select",{"onUpdate:modelValue":e[6]||(e[6]=i=>t.pageSize=i),onChange:e[7]||(e[7]=i=>t.currentPage=1)},e[19]||(e[19]=[s("option",{value:"10"},"10 æ¡",-1),s("option",{value:"20"},"20 æ¡",-1),s("option",{value:"50"},"50 æ¡",-1)]),544),[[E,t.pageSize]])]),s("div",me,[s("button",{disabled:t.currentPage<=1,onClick:e[8]||(e[8]=i=>t.currentPage--)},"ä¸Šä¸€é¡µ",8,ye),s("span",xe,"ç¬¬ "+d(t.currentPage)+" é¡µï¼Œå…± "+d(l.totalPages)+" é¡µ",1),s("button",{disabled:t.currentPage>=l.totalPages,onClick:e[9]||(e[9]=i=>t.currentPage++)},"ä¸‹ä¸€é¡µ",8,we)])])])):v("",!0)])):(h(),g("div",R,[e[15]||(e[15]=s("h3",null,"ä»»åŠ¡ä¸å­˜åœ¨æˆ–å·²è¢«åˆ é™¤",-1)),S(r,{to:"/generated-testcases"},{default:T(()=>e[14]||(e[14]=[m("è¿”å›ä»»åŠ¡åˆ—è¡¨",-1)])),_:1,__:[14]})])),t.showCaseDetail?(h(),g("div",{key:3,class:"case-detail-modal",onClick:e[12]||(e[12]=(...i)=>l.closeCaseDetail&&l.closeCaseDetail(...i))},[s("div",{class:"modal-content",onClick:e[11]||(e[11]=L(()=>{},["stop"]))},[s("div",Se,[e[21]||(e[21]=s("h3",null,"æµ‹è¯•ç”¨ä¾‹è¯¦æƒ…",-1)),s("button",{class:"close-btn",onClick:e[10]||(e[10]=(...i)=>l.closeCaseDetail&&l.closeCaseDetail(...i))},"Ã—")]),s("div",Te,[s("div",De,[e[22]||(e[22]=s("label",null,"ç”¨ä¾‹ç¼–å·:",-1)),s("span",null,d(t.selectedCase.caseId||`TC${String(t.selectedCaseIndex+1).padStart(3,"0")}`),1)]),s("div",Ie,[e[23]||(e[23]=s("label",null,"æµ‹è¯•åœºæ™¯:",-1)),s("p",null,d(t.selectedCase.scenario),1)]),s("div",Pe,[e[24]||(e[24]=s("label",null,"å‰ç½®æ¡ä»¶:",-1)),s("p",null,d(t.selectedCase.precondition),1)]),s("div",Ee,[e[25]||(e[25]=s("label",null,"æ“ä½œæ­¥éª¤:",-1)),s("p",{class:"test-steps",innerHTML:t.selectedCase.steps},null,8,Le)]),s("div",Ae,[e[26]||(e[26]=s("label",null,"é¢„æœŸç»“æœ:",-1)),s("p",{innerHTML:t.selectedCase.expected},null,8,Me)]),s("div",ze,[e[27]||(e[27]=s("label",null,"ä¼˜å…ˆçº§:",-1)),s("span",{class:k(["priority-tag",(o=t.selectedCase.priority)==null?void 0:o.toLowerCase()])},d(t.selectedCase.priority||"ä¸­"),3)])])])])):v("",!0)])}const qe=x(z,[["render",Fe],["__scopeId","data-v-065992cf"]]);export{qe as default};
