import{Q as L,u as Q,q as m,V as S,x as z,r as i,o as d,c as _,b as $,d as e,w as o,C as v,e as f,F as N,y as T,J as P,f as R}from"./index-0220ec78.js";const G={class:"page-container"},H={key:0,class:"card-container"},K={key:1,class:"card-container"},X={__name:"TestCaseEdit",setup(O){const V=L(),w=Q(),g=m(),x=m(!0),y=m(!1),k=m([]),b=m([]),l=S({title:"",description:"",project_id:null,priority:"medium",test_type:"functional",status:"draft",preconditions:"",steps:"",expected_result:"",version_ids:[]}),q={title:[{required:!0,message:"请输入用例标题",trigger:"blur"},{min:5,max:500,message:"标题长度在 5 到 500 个字符",trigger:"blur"}],expected_result:[{required:!0,message:"请输入预期结果",trigger:"blur"}],steps:[{max:1e3,message:"操作步骤不能超过1000个字符",trigger:"blur"}]},j=r=>r?r.replace(/<br\s*\/?>/gi,`
`):"",C=r=>r?r.replace(/\n/g,"<br>"):"",E=async()=>{try{const r=await v.get("/projects/list/");k.value=r.data.results||[]}catch{f.error("获取项目列表失败")}},U=async r=>{if(!r){b.value=[];return}try{const t=await v.get(`/versions/projects/${r}/versions/`);b.value=t.data||[]}catch(t){console.error("获取项目版本失败:",t),f.error("获取项目版本失败"),b.value=[]}},F=r=>{l.version_ids=[],U(r)},M=()=>{},A=async()=>{var r;try{const s=(await v.get(`/testcases/${V.params.id}/`)).data;l.title=s.title,l.description=s.description,l.project_id=((r=s.project)==null?void 0:r.id)||null,l.priority=s.priority,l.test_type=s.test_type,l.status=s.status,l.preconditions=s.preconditions,l.expected_result=j(s.expected_result||""),l.steps=j(s.steps||""),l.version_ids=s.versions?s.versions.map(u=>u.id):[],l.project_id&&await U(l.project_id),x.value=!1}catch{f.error("获取用例详情失败"),w.back()}},D=async()=>{g.value&&await g.value.validate(async r=>{if(r){y.value=!0;try{const t={...l,steps:C(l.steps||""),expected_result:C(l.expected_result||"")};await v.put(`/testcases/${V.params.id}/`,t),f.success("测试用例修改成功"),w.push(`/ai-generation/testcases/${V.params.id}`)}catch(t){f.error("测试用例修改失败"),console.error("提交错误:",t)}finally{y.value=!1}}})};return z(async()=>{await E(),await A()}),(r,t)=>{const s=i("el-input"),u=i("el-form-item"),n=i("el-option"),p=i("el-select"),c=i("el-col"),h=i("el-row"),B=i("el-button"),I=i("el-form"),J=i("el-skeleton");return d(),_("div",G,[t[13]||(t[13]=$("div",{class:"page-header"},[$("h1",{class:"page-title"},"编辑测试用例")],-1)),x.value?(d(),_("div",K,[e(J,{rows:10,animated:""})])):(d(),_("div",H,[e(I,{ref_key:"formRef",ref:g,model:l,rules:q,"label-width":"100px"},{default:o(()=>[e(u,{label:"用例标题",prop:"title"},{default:o(()=>[e(s,{modelValue:l.title,"onUpdate:modelValue":t[0]||(t[0]=a=>l.title=a),placeholder:"请输入测试用例标题"},null,8,["modelValue"])]),_:1}),e(u,{label:"用例描述",prop:"description"},{default:o(()=>[e(s,{modelValue:l.description,"onUpdate:modelValue":t[1]||(t[1]=a=>l.description=a),type:"textarea",rows:4,placeholder:"请输入用例描述"},null,8,["modelValue"])]),_:1}),e(h,{gutter:20},{default:o(()=>[e(c,{span:8},{default:o(()=>[e(u,{label:"归属项目",prop:"project_id"},{default:o(()=>[e(p,{modelValue:l.project_id,"onUpdate:modelValue":t[2]||(t[2]=a=>l.project_id=a),placeholder:"请选择项目",clearable:"",filterable:"",onChange:F},{default:o(()=>[(d(!0),_(N,null,T(k.value,a=>(d(),P(n,{key:a.id,label:a.name,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(c,{span:8},{default:o(()=>[e(u,{label:"优先级",prop:"priority"},{default:o(()=>[e(p,{modelValue:l.priority,"onUpdate:modelValue":t[3]||(t[3]=a=>l.priority=a),placeholder:"请选择优先级"},{default:o(()=>[e(n,{label:"低",value:"low"}),e(n,{label:"中",value:"medium"}),e(n,{label:"高",value:"high"}),e(n,{label:"紧急",value:"critical"})]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(c,{span:8},{default:o(()=>[e(u,{label:"测试类型",prop:"test_type"},{default:o(()=>[e(p,{modelValue:l.test_type,"onUpdate:modelValue":t[4]||(t[4]=a=>l.test_type=a),placeholder:"请选择测试类型"},{default:o(()=>[e(n,{label:"功能测试",value:"functional"}),e(n,{label:"集成测试",value:"integration"}),e(n,{label:"API测试",value:"api"}),e(n,{label:"UI测试",value:"ui"}),e(n,{label:"性能测试",value:"performance"}),e(n,{label:"安全测试",value:"security"})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(h,{gutter:20},{default:o(()=>[e(c,{span:12},{default:o(()=>[e(u,{label:"状态",prop:"status"},{default:o(()=>[e(p,{modelValue:l.status,"onUpdate:modelValue":t[5]||(t[5]=a=>l.status=a),placeholder:"请选择状态"},{default:o(()=>[e(n,{label:"草稿",value:"draft"}),e(n,{label:"激活",value:"active"})]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(c,{span:12},{default:o(()=>[e(u,{label:"关联版本"},{default:o(()=>[e(p,{modelValue:l.version_ids,"onUpdate:modelValue":t[6]||(t[6]=a=>l.version_ids=a),placeholder:"请选择版本（可多选）",multiple:"",clearable:"",filterable:"",onChange:M},{default:o(()=>[(d(!0),_(N,null,T(b.value,a=>(d(),P(n,{key:a.id,label:a.name+(a.is_baseline?" (基线)":""),value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(u,{label:"前置条件",prop:"preconditions"},{default:o(()=>[e(s,{modelValue:l.preconditions,"onUpdate:modelValue":t[7]||(t[7]=a=>l.preconditions=a),type:"textarea",rows:3,placeholder:"请输入前置条件"},null,8,["modelValue"])]),_:1}),e(u,{label:"操作步骤",prop:"steps"},{default:o(()=>[e(s,{modelValue:l.steps,"onUpdate:modelValue":t[8]||(t[8]=a=>l.steps=a),type:"textarea",rows:6,maxlength:"1000","show-word-limit":"",placeholder:`请输入详细的操作步骤，如：
1. 打开登录页面
2. 输入用户名和密码
3. 点击登录按钮
4. 验证登录结果`},null,8,["modelValue"])]),_:1}),e(u,{label:"预期结果",prop:"expected_result"},{default:o(()=>[e(s,{modelValue:l.expected_result,"onUpdate:modelValue":t[9]||(t[9]=a=>l.expected_result=a),type:"textarea",rows:3,placeholder:"请输入整体预期结果"},null,8,["modelValue"])]),_:1}),e(u,null,{default:o(()=>[e(B,{type:"primary",onClick:D,loading:y.value},{default:o(()=>t[11]||(t[11]=[R(" 保存修改 ",-1)])),_:1,__:[11]},8,["loading"]),e(B,{onClick:t[10]||(t[10]=a=>r.$router.back())},{default:o(()=>t[12]||(t[12]=[R("取消",-1)])),_:1,__:[12]})]),_:1})]),_:1},8,["model"])]))])}}};export{X as default};
